---
title: Python 进阶讲义（一）：基础知识
tags:
  - 笔记
category:
  - Python 进阶讲义
---

<!-- more -->

# 元组

元组（tuple 或 array）是不可变的列表，使用 `(...)` 创建。需注意创建仅1个元素的元组时，须在元素后加一个逗号。例如：

```py
a = (2, 3)
b = (1,)
```

# 函数

函数（function）表示一组特定的操作。例如把到书架取书的过程抽象为函数：

```py
def get_book(book: Book) -> None:
    """
    取书
    
    参数：
      book  - 要取的书
    """
    location = current_location()  # 有返回值而无参数的函数调用
    goto(shelf)  # 无返回值而有参数的调用
    get_item(find(book))  # 将一个函数的返回值作为另一函数的参数
    goto(location)
```

如上是把到书架取书的过程抽象得到的函数。

## 函数文档

使用 `"""..."""` 创建可跨行的长字符串。在函数签名（`def` 所在行）的下一行使用长字符串来添加函数文档（document）。函数文档在 IDE 中会在调用函数时显示，并包含在 pydoc 自动生成的模块文档中。函数文档中应包含的内容有：

- 函数功能
- 参数（若有）及说明
- 返回值（若有）及说明

## 类型注解

`: Book` 是参数的类型注解（type hint），指定 `book` 的类型，强制调用时传入的 `book` 是指定类型（`Book`）的实例。

` -> None` 是返回值的类型注解，指定函数返回值的类型。对于此函数则为空（`None`）。

在 Python 中，类型注解是可选的，在可用时会由 IDE 自动推断。但无类型注解时可能会发生意外情况。例如，字符串和数字都能用 `+` 连接，当函数内进行两数相加时，若传入字符串，且无类型注解，那么可能会把两字符串连接，产生意外结果。因此可能时应添加类型注解。

## 调用

`goto(...)` 等是调用（call）。调用时，将参数依次放在 `()` 之间。

 - 对于无默认值的参数，可以按序排列，无需指定参数名；
   - 或指定参数名，此时无需按序排列。
 - 对于有默认值的参数（必须在无默认值的参数之后），必须指定参数名。

## 参数收集

定义函数时，在参数名前加上 `*` 或 `**` 可进行“参数收集”，此时，传入的任何不符合其他参数的参数：

- 对于未指定名称的参数，将被作为一个列表传入。在函数内通过前有 `*` 的参数（通常为 `*args`）访问。
- 对于指定了名称的参数，将被作为一个字典传入。在函数内通过前有 `**` 的参数（通常为 `**kwargs`）访问。

这使得参数的个数可变。例如：

```py
def print_without_endl(*args):
    for arg in args:  # 所有传入的参数将为作为一个列表处理
        print(arg, end="")  # `end` 指定结束符，默认为 "\n"（换行符）
```

调用时：

```py
>>> print_without_endl("a", "b", "c")
abc

>>> print_without_endl("a", "b", "c", "d")
abcd
```

> 在 Python 文档中，常用 `>>>` 表示在 REPL 中的输入，其后为输出。

## 返回值

在函数内使用 `return` 关键字为函数添加返回值。在有返回值类型注解时，返回的返回值必须符合类型注解。例：

```py
def square(x: int) -> int:
    return x ** 2
```

可有多个返回值，返回值间用 `,` 分隔。此时返回的所有值会被封装成元组（不可变的列表）。

# 序列封、解包

```py
>>> vals = 1, 2, 3
>>> vals
(4, 5)

>>> a, b = [2, 3]
>>> a
2
>>> b
3

>>> x, y = 4, 5
>>> x
4
>>> y
5
```

如上，赋值时在等号右侧用逗号连接各项，各项会被封装成元组传递。

同样，在等号左边用逗号连接各项，若右侧是列表、元组等序列，且长度与左侧项数相等，则右侧序列的各项会依次被赋值给左侧各项。

在 `for` 循环中也可使用解包：

```py
squares = ((1,1), (2,4), (3,9))

for x, square in squares:
    print(x, "的平方是", square)  # 输出：1 的平方是 1……
```

# 类和面向对象编程

类（class）是对一类事物的共同特征的抽象描述，类似于数学上使用描述法定义集合。例如，狗具有的共同特征：

 - 会吠叫
 - 会吃东西
 - 有不同的毛色
 - ……

将狗抽象为一个类：

```py
class Dog:
    """
    狗

    属性：
      fur_color  - 毛色
    """
    fur_color = Color.rgb("FFFFFF")  # 声明毛色属性，默认值为白色（FFFFFF）
    def bark(self) -> None:
        ...
    
    def eat(self, food: str) -> None:
        ...
```

使用 `class` 关键字声明类，其后指定类名。

## 类文档

与函数类似，在 `class` 的下一行使用长字符串可添加类文档。类文档应包含类的属性及说明。类文档同样会在 IDE 中显示，包含在模块文档中。

## 属性

在类中声明的变量称为类的属性（property）。属性可以没有默认值，但一般有类型注解。

## 方法

类中的函数称为方法（method）。方法必须有至少一个参数。在通过对象调用时，第一个参数（通常命名为 `self`）无需手动传入，而是由 Python 自动赋值。其值为被调用的对象。在通过类调用方法时，则需手动传入对象。

在方法内可通过 `self` 访问类的属性或调用其他方法。

类的属性和方法统称为类的成员。

## 对象

类的对象（object）是类的实例。例如上文代码中，一只只狗是 `Dog` 类的对象。

## 点记法

```py
# 续上
dog = Dog()
dog.fur_color = Color.rgb("000000")  # 手动赋值，替代默认值。
dog.bark()  # 等价于：Dog.bark(dog)
dog.eat("apple")  # 等价于：Dog.eat(dog, "apple")
```

如上，在创建对象后，可通过用点连接对象和成员来操作对象的成员。

## 继承

一类事物可能具有另一类事物的共同特征。正如数学上的子集，类也有父类与子类。子类自动从父类继承所有方法和属性。例如：

```py
class Animal:
    color = Color.rgb("FFFFFF")
    ...

class Dog(Animal):
    ...

print(Dog().color)  # Color(#FFFFFF)
```

如上，定义类时，在冒号前添加括号，并在其中指定父类。

所有未指定父类的类都自动继承 `object` 类。因此 `object` 是所有类的间接父类。

## 特殊方法

特殊方法是形如 `__xxx__()` 的方法。这些方法通常不直接调用，并有其特殊的用途。`object` 类中已定义了所有特殊方法。我们可以重写这些方法来自定义类的行为。

### `__init__()`

`__init__` 在对象初始化时被调用。`object` 中，`__init__` 仅有一个参数，即 `self`。